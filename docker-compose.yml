services:

  # we use kamailio 5.7.5 built from source code
  # kamailio has the ip 200.200.200.4
  # kamailio configuration file can be found here "/usr/local/etc/kamailio/kamailio.cfg"
  kamailio:
    container_name: kamailio
    image: debian_11_kamailio:5.7.5
    build:
      context: ./dockerfiles/kamailio_5.7.5
    hostname: kamailio_sip_proxy
    volumes:
      - ./kamailio_configuration/:/usr/local/etc/kamailio/
    networks:
      kamailio_PRACK_network:
        ipv4_address: 200.200.200.3
    entrypoint: /usr/local/sbin/kamailio
    command: -DD -dd -e -E -M 16 -m 8

  # the callee is a SIPp instance
  # UAS listening on  200.200.200.4:5060
  callee:
    container_name: callee
    image: debian-sipp:latest
    build:
      context: ./dockerfiles/SIPp
    hostname: the_callee
    volumes:
      - ./sipp_scenarios/:/tools/sipp/sipp_scenarios/
    command: sh -c "sipp -aa -sf /tools/sipp/sipp_scenarios/uas.xml -i 200.200.200.4 -p 5060"
    networks:
      kamailio_PRACK_network:
        ipv4_address: 200.200.200.4


  # the caller is a SIPp instance
  # UAC listening on  200.200.200.2:5080
  # Command to send
  # sipp -aa -trace_err -sf sipp_scenarios/uac.xml -i 200.200.200.2 -p 5080 -s called_party 200.200.200.3:5060 -m   1
  caller:
    container_name: caller
    image: debian-sipp:latest
    build:
      context: ./dockerfiles/SIPp
    hostname: the_caller
    volumes:
      - ./sipp_scenarios/uac.xml:/tools/sipp/sipp_scenarios/uac.xml
    stdin_open: true
    tty: true
#    depends_on:
#      - kamailio
#      - callee
    networks:
      kamailio_PRACK_network:
        ipv4_address: 200.200.200.2

networks:
  kamailio_PRACK_network:
    driver: bridge
    name: "kamailio_PRACK_network"
    ipam:
      config:
        - subnet: 200.200.200.0/24
